<div class="game-shell">
  <app-babylon-canvas></app-babylon-canvas>

  <app-splash-screen *ngIf="viewState === 'splash'" (complete)="viewState = 'menu'"></app-splash-screen>

  <app-main-menu
    *ngIf="viewState === 'menu' || viewState === 'gameover'"
    (start)="handleStartStory($event)"
  ></app-main-menu>

  <app-narrative-overlay *ngIf="viewState === 'intro'" [script]="introScript" (complete)="handleIntroComplete()"></app-narrative-overlay>

  <ng-container *ngIf="viewState === 'game'">
    <app-jrpg-hud></app-jrpg-hud>
    <app-quest-objective></app-quest-objective>

    <div class="alignment-wrap">
      <app-alignment-bar></app-alignment-bar>
    </div>

    <app-quest-log [isOpen]="questLogOpen" (close)="closeQuestLog()"></app-quest-log>
    <app-quest-accept-dialog
      [isOpen]="showQuestAccept"
      [quest]="pendingQuest"
      (accept)="handleQuestAccept()"
      (decline)="handleQuestDecline()"
    ></app-quest-accept-dialog>
    <app-quest-completion-dialog
      [isOpen]="showQuestCompletion"
      [rewards]="questRewards"
      (close)="handleQuestCompletionClose()"
    ></app-quest-completion-dialog>

    <app-combat-text *ngIf="combatText" [message]="combatText.message" [color]="combatText.color"></app-combat-text>
    <app-combat-arena></app-combat-arena>

    <button type="button" class="quest-log-btn" (click)="toggleQuestLog()">ðŸ“‹ Quests</button>
  </ng-container>

  <div class="scanlines"></div>
</div>
