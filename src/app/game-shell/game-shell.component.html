<div class="game-shell">
  <app-babylon-canvas></app-babylon-canvas>

  <app-splash-screen *ngIf="viewState === 'splash'" (complete)="viewState = 'menu'"></app-splash-screen>

  <app-main-menu
    *ngIf="viewState === 'menu' || viewState === 'gameover'"
    (start)="handleStartStory($event)"
  ></app-main-menu>

  <app-narrative-overlay
    *ngIf="viewState === 'intro'"
    [script]="introScript"
    (complete)="handleIntroComplete()"
  ></app-narrative-overlay>
  <app-dialogue-overlay *ngIf="viewState === 'game'"></app-dialogue-overlay>

  <ng-container *ngIf="viewState === 'game'">
    <app-jrpg-hud></app-jrpg-hud>
    <app-quest-objective></app-quest-objective>
    <app-hud-debug-overlay *ngIf="showHudDebug"></app-hud-debug-overlay>

    <div class="alignment-wrap">
      <app-alignment-bar></app-alignment-bar>
    </div>

    <app-quest-log [isOpen]="questLogOpen" (close)="closeQuestLog()"></app-quest-log>
    <app-inventory-screen
      [isOpen]="inventoryOpen"
      [inventory]="inventory"
      [credits]="credits"
      (close)="closeInventory()"
      (useItem)="handleUseItem($event)"
      (equipItem)="handleEquipItem($event)"
    ></app-inventory-screen>
    <app-quest-accept-dialog
      [isOpen]="showQuestAccept"
      [quest]="pendingQuest"
      (accept)="handleQuestAccept()"
      (decline)="handleQuestDecline()"
    ></app-quest-accept-dialog>
    <app-quest-completion-dialog
      [isOpen]="showQuestCompletion"
      [questTitle]="questCompletionTitle"
      [rewards]="questRewards"
      (close)="handleQuestCompletionClose()"
    ></app-quest-completion-dialog>

    <app-combat-text
      *ngIf="combatText || floatingDamages.length"
      [message]="combatText?.message || null"
      [color]="combatText?.color || '#ef4444'"
      [floatingDamages]="floatingDamages"
    ></app-combat-text>
    <app-combat-arena></app-combat-arena>

    <button type="button" class="quest-log-btn" (click)="toggleQuestLog()">ðŸ“‹ Quests</button>
    <button type="button" class="inventory-btn" (click)="toggleInventory()">ðŸŽ’ Inventory</button>
  </ng-container>

  <div class="scanlines"></div>
</div>
